<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Syrian Refugee Crisis</title>

    <!-- Milligram CSS -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.4.1/milligram.css"> 
   
    <!-- Load Javascript files -->
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/d3/6.1.1/d3.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>

    <script src="http://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <!-- <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script> -->

    <!-- Load Vega Lite -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5.17.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@4.17.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.12.2"></script>
    <style media="screen">
      /* Add space between Vega-Embed links  */
      .vega-actions a {
        margin-right: 5px;
      }
    </style>

    <!-- Mi CSS -->
    <link rel="stylesheet" href="./css/style.css" />

    <!-- Mi JavaScript -->
    <script defer src="./js/script.js" delay></script>

  </head>
  <body>
    <h1>
      Overview of Syrian Refugee Crisis
    </h1>
    <div class="container">
      <hr class="rounded">
      <h3>
        Introduction and Background
      </h3>
      <p>
        The refugee situation around the world, according to UNHCR, is affecting about one percent of humanity – 1 in every 97 people – and the number is growing by the year.  <br>
        Over the past decade, over 100 million people have been displaced from their countries of origin and the majority of them were not able to return home and were forcefully settled somewhere else.  <br>
        After much debate and consideration, our team has decided to dedicate our final project to presenting the history, the current situation as well as the impact of this ongoing event, which is the largest refugee and displacement crisis of our time that is still affecting about 17.6 million Syrians and numerous countries involved. <br>
        We believe that this project allows for a good educational and informational opportunity for us to present some critical data, using the various carefully crafted visualizations, to tell our audience a story about these people who were/are forced to leave their home due to endless violence and collapsed infrastructure spiraled off the Syrian Civil War, a war that has destroyed too many lives and families.
      </p>
    </div>
    <div class="container">
      <hr class="rounded">
      <h3>
        World Refugee Data
      </h3>
      <p>
        Syrian refugees hold the second place in the proportion of refugees around the world <br>
        They account for more than a third of the world’s total refugee population
      </p>
      <div id="line1">line chart 1</div>
      <!-- <div id="pie1">pie chart 1</div> -->
    </div>
    <div class="container">
      <hr class="rounded">
      <h3>
        Cause of Syrian Refugee
      </h3>
      <p>
        The Syrian Refugee Crisis started with the Syrian Civil War. The war started in 15 of March 2011 and it is still taking place. <br>
        During all those years, there has been numberous casualties, including civilians and non civilians, women and men, girls and boys. 
      </p>
      <div id="bar2">bar chart</div>
      <div id="pie2">pie chart 2</div>
    </div>
    <div class="container">
      <hr class="rounded">
      <h3>
        Refugee Destinations
      </h3>
      <p>
        This "interactive" map shows you the destinations of Syrian refugees, and the line chart displays the GDP of those destination countries. 
      </p>
    </div>
    <svg id="map3" width="750" height="480"></svg>
    <div id="tooltip"></div>
    <br>
    <div id="line3">line chart 3</div>

    <script>

      // The svg
      var svg = d3.select("svg"),
        width = +svg.attr("width"),
        height = +svg.attr("height");

      // Map and projection
      var path = d3.geoPath();
      var projection = d3.geoMercator()
        .scale(550)
        .center([33,44])
        // .translate([width / 2, height / 2]);

      // Data and color scale
      var data = d3.map();
      var colorScale = d3.scaleThreshold()
        .domain([0, 100, 1000, 10000, 100000, 500000, 1000000, 5000000, 10000000])
        .range(d3.schemeGreys[9]);

      // Load external data and boot
      d3.queue()
        .defer(d3.json, "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")
        // .defer(d3.csv, "./data/destination.csv", function(d) { data.set(d.Code, d.Total); })
        .defer(d3.csv, "./data/destination.csv")
        .defer(d3.csv, "./data/raw_unemployment.csv")
        .await(ready);

      function ready(error, topo, destination, unemployment) {

        console.log(topo)
        destination = destination.filter(d=>d.Year==2019)
        console.log(destination)
        console.log(unemployment)

        let getPop = function(d) {
          detail = destination.filter(i=>i.Code==d.id)[0];
          if (detail==null) {
            count = 0
          } else {
            count = detail.Total
          }
          return count;
        }

        let mouseOver = function(d) {
          // console.log(getPop(d))
          // console.log(d)
          d3.selectAll(".Country")
            // .transition()
            // .duration(200)
            .style("opacity", 0.5)
          d3.select(this)
            // .transition()
            // .duration(200)
            .style("opacity", 1)
            .style("stroke-width", "3")
          const pos = d3.pointer(event, window);
          tooltip = d3.select('#tooltip')
            .style('display', 'block')
            .style("position", "absolute")
            .style("border", "solid")
            .style("border-width", "2px")
            .style("border-radius", "5px")
            .style("padding", "5px")
            .style('top', pos[1]-100 + "px")
            .style('left', pos[0]-50 + "px")
            .style('background-color', 'white')
            .style('color', 'black')
            .html(`<div style='font-size:15px'>Country: ${d.properties.name} <br> Number of refugee: ${getPop(d)}</div>`)
        }

        let mouseLeave = function(d) {
          d3.selectAll(".Country")
            .transition()
            .duration(100)
            .style("opacity", 1)
          d3.select(this)
            .transition()
            .duration(100)
            .style("stroke-width", "1")
          d3.select('#tooltip')
            .style('display', 'none');
        }

        let getColor = function(d) {
          // console.log(d.id)
          // console.log(destination.filter(i=>i.Code==d.id)[0])
          // d.total = data.get(d.id) || 0;
          detail = destination.filter(i=>i.Code==d.id)[0]
          if (detail==null){
            total = 0
          } else {
            total = destination.filter(i=>i.Code==d.id)[0].Total
          }
          return colorScale(total)
        }

        // Draw the map
        svg.append("g")
          .selectAll("path")
          .data(topo.features)
          .enter()
          .append("path")
          // draw each country
          .attr("d", d3.geoPath()
            .projection(projection)
          )
          // set the color of each country
          .attr("fill", getColor)
          .style("stroke", "black")
          .attr("class", function(d){ return "Country" } )
          .style("opacity", 1)
          .on("mouseover", mouseOver )
          .on("mouseleave", mouseLeave )
      }

    </script>
    
  </body>
</html>
